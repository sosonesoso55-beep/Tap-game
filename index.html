<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anime Tap</title>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: #0b0e14;
  color: #fff;
  text-align: center;
}
.card {
  background: #151a2d;
  margin: 10px;
  padding: 15px;
  border-radius: 15px;
}
button {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg,#6c8cff,#ff4ecd);
  color: white;
  font-size: 16px;
}
.hidden { display: none; }
</style>
</head>

<body>

<h1>‚ö° Anime Tap</h1>

<div class="card" id="main">
  <p>–û—á–∫–∏: <b id="score">0</b></p>
  <p id="boostInfo"></p>
  <button onclick="tap()">TAP üí•</button>

  <button onclick="openTab('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
  <button onclick="openTab('leaderboard')">üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</button>
</div>

<div class="card hidden" id="shop">
  <h3>üõí –ú–∞–≥–∞–∑–∏–Ω (10 –º–∏–Ω—É—Ç)</h3>

  <button onclick="buyBoost(2, 500)">x2 ‚Äî 500 –æ—á–∫–æ–≤</button>
  <button onclick="buyBoost(5, 3000)">x5 ‚Äî 3000 –æ—á–∫–æ–≤</button>

  <button onclick="back()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<div class="card hidden" id="leaderboard">
  <h3>üèÜ –õ–∏–¥–µ—Ä–±–æ—Ä–¥</h3>
  <ol id="leaders"></ol>
  <button onclick="back()">‚¨Ö –ù–∞–∑–∞–¥</button>
</div>

<script>
const SERVER = "https://anime-tap-server.onrender.com";
const BOOST_TIME = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç

let uid = localStorage.getItem("uid") || crypto.randomUUID();
localStorage.setItem("uid", uid);

let score = 0;

function getBoost() {
  const end = Number(localStorage.getItem("boostEnd"));
  const boost = Number(localStorage.getItem("boost")) || 1;
  if (Date.now() > end) {
    localStorage.removeItem("boost");
    localStorage.removeItem("boostEnd");
    return 1;
  }
  return boost;
}

function updateBoostUI() {
  const end = Number(localStorage.getItem("boostEnd"));
  if (!end) {
    boostInfo.textContent = "–ë—É—Å—Ç: x1";
    return;
  }
  const left = Math.max(0, Math.floor((end - Date.now()) / 1000));
  boostInfo.textContent = `–ë—É—Å—Ç: x${getBoost()} (${left}s)`;
}

setInterval(updateBoostUI, 1000);

function tap() {
  fetch(`${SERVER}/tap`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      uid,
      multi: getBoost()
    })
  })
  .then(r=>r.json())
  .then(d=>{
    score = d.score;
    scoreEl.textContent = score;
  });
}

function buyBoost(multiplier, cost) {
  if (score < cost) return alert("‚ùå –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –æ—á–∫–æ–≤");

  localStorage.setItem("boost", multiplier);
  localStorage.setItem("boostEnd", Date.now() + BOOST_TIME);

  alert(`‚úÖ x${multiplier} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ 10 –º–∏–Ω—É—Ç`);
}

function openTab(id) {
  document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  if (id === "leaderboard") loadLeaders();
}

function back() {
  document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));
  main.classList.remove("hidden");
}

function loadLeaders() {
  fetch(`${SERVER}/leaderboard`)
    .then(r=>r.json())
    .then(data=>{
      leaders.innerHTML = "";
      data.forEach(u=>{
        const li = document.createElement("li");
        li.textContent = u.uid.slice(0,6)+"‚Ä¶ ‚Äî "+u.score;
        leaders.appendChild(li);
      });
    });
}

const scoreEl = document.getElementById("score");
const boostInfo = document.getElementById("boostInfo");
updateBoostUI();
</script>

</body>
</html>
