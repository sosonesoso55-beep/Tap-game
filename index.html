<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>AnimeTap</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Telegram -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  user-select:none;
  font-family:Arial, sans-serif;
}

body{
  height:100vh;
  background:radial-gradient(circle,#3a005c,#000);
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:space-between;
}

header{
  text-align:center;
  margin-top:16px;
}

#score{
  font-size:22px;
  margin-top:6px;
}

#tap{
  width:260px;
  height:260px;
  border-radius:50%;
  background:url("tap.png") center/cover no-repeat;
  box-shadow:0 0 40px #b300ff;
  transition:transform .05s;
}

#tap:active{
  transform:scale(.95);
}

.menu{
  width:100%;
  display:flex;
  justify-content:space-around;
  padding:12px 0;
  background:rgba(0,0,0,.6);
}

.menu button{
  background:none;
  border:none;
  color:white;
  font-size:12px;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-box{
  background:#1b0029;
  padding:18px;
  border-radius:14px;
  width:85%;
  text-align:center;
}

.modal-box button{
  margin-top:12px;
  padding:8px 14px;
  border:none;
  border-radius:8px;
  background:#8f00ff;
  color:white;
}
</style>
</head>

<body>

<header>
  <h2>AnimeTap</h2>
  <div id="score">–û—á–∫–∏: 0</div>
</header>

<div id="tap"></div>

<div class="menu">
  <button onclick="openMenu('profile')">üë§</button>
  <button onclick="openMenu('top')">üèÜ</button>
  <button onclick="openMenu('donate')">üíé</button>
</div>

<div class="modal" id="modal">
  <div class="modal-box" id="modalBox"></div>
</div>

<script>
/* ================= –ù–ê–°–¢–†–û–ô–ö–ò ================= */
const SERVER_URL = "https://YOUR_SERVER_URL"; // ‚Üê –ó–ê–ú–ï–ù–ò
const SECRET = "SECRET_KEY"; // –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–æ–º
/* ============================================ */

const tg = Telegram.WebApp;
tg.expand();

const user = tg.initDataUnsafe.user;
const userId = user.id;
const username = user.username || "user";

/* –°–û–°–¢–û–Ø–ù–ò–ï */
let score = 0;

/* –ü–û–î–ü–ò–°–¨ (–ê–ù–¢–ò–ß–ò–¢) */
function sign(value){
  return CryptoJS.SHA256(userId + ":" + value + ":" + SECRET).toString();
}

/* UI */
const scoreEl = document.getElementById("score");
function updateUI(){
  scoreEl.innerText = "–û—á–∫–∏: " + score;
}

/* –¢–ê–ü */
document.getElementById("tap").onclick = () => {
  score++;
  updateUI();
  save();
};

/* –°–û–•–†–ê–ù–ï–ù–ò–ï –ù–ê –°–ï–†–í–ï–† */
function save(){
  fetch(SERVER_URL + "/save",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      id:userId,
      name:username,
      score:score,
      sign:sign(score)
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.error){
      alert("–ê–Ω—Ç–∏—á–∏—Ç: –¥–∞–Ω–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã");
    }
  });
}

/* –ú–ï–ù–Æ */
function openMenu(type){
  const box = document.getElementById("modalBox");
  const modal = document.getElementById("modal");

  if(type==="profile"){
    box.innerHTML = `
      <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
      <p>@${username}</p>
      <p>–û—á–∫–∏: ${score}</p>
      <button onclick="closeMenu()">–ó–∞–∫—Ä—ã—Ç—å</button>
    `;
  }

  if(type==="top"){
    box.innerHTML = `<h3>–õ–∏–¥–µ—Ä–±–æ—Ä–¥</h3><p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>`;
    fetch(SERVER_URL + "/top")
      .then(r=>r.json())
      .then(top=>{
        box.innerHTML = `
          <h3>üèÜ –¢–û–ü</h3>
          ${top.map(t=>`<p>${t.place}. ${t.name || "user"} ‚Äî ${t.score}</p>`).join("")}
          <button onclick="closeMenu()">–ó–∞–∫—Ä—ã—Ç—å</button>
        `;
      });
  }

  if(type==="donate"){
    box.innerHTML = `
      <h3>Telegram Stars</h3>
      <p>1000 –æ—á–∫–æ–≤</p>
      <button onclick="buyStars()">–ö—É–ø–∏—Ç—å</button>
      <button onclick="closeMenu()">–ó–∞–∫—Ä—ã—Ç—å</button>
    `;
  }

  modal.style.display = "flex";
}

function closeMenu(){
  document.getElementById("modal").style.display = "none";
}

/* DONATE */
function buyStars(){
  tg.openInvoice({
    title: "1000 –æ—á–∫–æ–≤",
    description: "–ü–æ–∫—É–ø–∫–∞ –æ—á–∫–æ–≤",
    currency: "XTR",
    prices: [{ label: "1000 –æ—á–∫–æ–≤", amount: 100 }],
    payload: "tap_pack_1000"
  });
}
</script>

</body>
</html>
