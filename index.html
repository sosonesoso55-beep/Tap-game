<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anime Tap</title>

<style>
*{box-sizing:border-box;user-select:none}
body{
margin:0;height:100vh;
background:radial-gradient(circle,#24003d,#000);
color:#fff;font-family:Arial;
display:flex;flex-direction:column;
align-items:center;overflow:hidden;
}

header{font-size:24px;margin:10px;text-shadow:0 0 15px #ff66ff}
#score{font-size:30px;margin-bottom:5px}
#coins{font-size:16px;opacity:.8}

#girl{
width:80vw;max-width:320px;
transition:.1s;
filter:drop-shadow(0 0 30px #ff66ff);
}

.menu{display:flex;gap:10px;margin:10px}
button{
background:linear-gradient(135deg,#ff3cac,#784ba0);
border:none;border-radius:12px;
padding:10px;color:white;
box-shadow:0 0 15px #ff66ff;
}

.panel{
position:absolute;bottom:90px;
background:rgba(0,0,0,.8);
border-radius:12px;
padding:12px;display:none;
width:85%;max-height:45%;
overflow:auto;
}

.item{
border-bottom:1px solid #444;
padding:8px 0;
display:flex;justify-content:space-between;
align-items:center;
}

.star{
position:fixed;font-size:22px;
animation:fly 1s forwards;
pointer-events:none;
}

@keyframes fly{
to{transform:translateY(-120px) scale(1.6);opacity:0}
}

.shake{
animation:shake .2s;
}
@keyframes shake{
0%{transform:translateX(0)}
25%{transform:translateX(-5px)}
50%{transform:translateX(5px)}
75%{transform:translateX(-5px)}
100%{transform:translateX(0)}
}
</style>
</head>

<body>

<header>ğŸŒ¸ Anime Tap</header>
<div id="score">0</div>
<div id="coins">ğŸ’ 0</div>

<img src="girl.png" id="girl">

<div class="menu">
<button onclick="toggleShop()">ğŸ›’ ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</button>
<button onclick="toggleTop()">ğŸ† Ğ¢ĞĞŸ</button>
</div>

<div id="shop" class="panel"></div>
<div id="top" class="panel"></div>

<script>
const SERVER="https://anime-tap-server-1.onrender.com";

const USER_ID=localStorage.uid||(localStorage.uid=Math.random().toString(36).slice(2));

let power=1, crit=0;

async function load(){
const r=await fetch(`${SERVER}/me?id=${USER_ID}`);
const d=await r.json();
document.getElementById("score").innerText=d.score;
document.getElementById("coins").innerText="ğŸ’ "+d.coins;
power=d.power||1;
crit=d.crit||0;
}

async function tap(e){
const r=await fetch(`${SERVER}/tap`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({id:USER_ID})
});
const d=await r.json();
document.getElementById("score").innerText=d.score;
document.getElementById("coins").innerText="ğŸ’ "+d.coins;

const img=document.getElementById("girl");
img.style.transform="scale(0.9)";
img.classList.add("shake");
setTimeout(()=>{img.style.transform="scale(1)";img.classList.remove("shake")},120);

const s=document.createElement("div");
s.className="star";
s.innerText=Math.random()<crit?"ğŸ’¥":"â­";
s.style.left=e.clientX+"px";
s.style.top=e.clientY+"px";
document.body.appendChild(s);
setTimeout(()=>s.remove(),1000);
}

function toggleShop(){
const s=document.getElementById("shop");
s.style.display=s.style.display=="block"?"none":"block";
s.innerHTML=`
<b>ğŸ›’ ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</b><br><br>

<div class="item">x2 Ğ½Ğ° 10 Ğ¼Ğ¸Ğ½ <button onclick="buy('x2')">50ğŸ’</button></div>
<div class="item">x5 Ğ½Ğ° 10 Ğ¼Ğ¸Ğ½ <button onclick="buy('x5')">120ğŸ’</button></div>
<div class="item">AutoTap 5 Ğ¼Ğ¸Ğ½ <button onclick="buy('auto')">80ğŸ’</button></div>

<hr>

<div class="item">+1 Ğ·Ğ° Ñ‚Ğ°Ğ¿ <button onclick="buy('p1')">60ğŸ’</button></div>
<div class="item">+2 Ğ·Ğ° Ñ‚Ğ°Ğ¿ <button onclick="buy('p2')">120ğŸ’</button></div>
<div class="item">ĞšÑ€Ğ¸Ñ‚ x3 <button onclick="buy('crit')">150ğŸ’</button></div>
`;
}

async function buy(type){
await fetch(`${SERVER}/buy`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({id:USER_ID,type})
});
load();
}

async function toggleTop(){
const t=document.getElementById("top");
if(t.style.display=="block"){t.style.display="none";return;}
const r=await fetch(`${SERVER}/leaderboard`);
const d=await r.json();
t.innerHTML="<b>ğŸ† Ğ¢ĞĞŸ</b><br><br>"+d.map((u,i)=>`${i+1}. ${u.score}`).join("<br>");
t.style.display="block";
}

document.getElementById("girl").onclick=tap;
load();
</script>

</body>
</html>
